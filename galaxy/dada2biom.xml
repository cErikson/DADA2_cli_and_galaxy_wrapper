<tool id="dada2biom" name="DADA2 Convert to BIOM." version="0.1.0">
    <requirements>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        dada2biom.py
		'$asv' 
		'$output'
		#if $taxa.opts == 'true':
			-t '$taxa.file'
		#end if
		#if $meta.opts == 'true':
			-s '$meta.metadata'
			-d $meta.delim
			-c '$meta.samp_col' 
			-r '$meta.regex'
		#end if
    ]]></command>
    <inputs>
        <param type="data" name="asv" label="ASV output from DADA2" format="tabular" />
		<conditional name="taxa" >
			<param name="opts" type="boolean" label="Have taxa metadata" />
			<when value="true">
				<param type="data" name="file" label="Taxa output from DADA2" format="tabular" />
			</when>
			<when value="false">
			</when>
		</conditional>
		<conditional name="meta" >
			<param name="opts" type="boolean" label="Have metadata" />
			<when value="true">
				<param type="data" name="metadata" format="tabular" label="A TSV of metadata corasponding to the samples" />
				<param type="text" name="delim" label="Sample metadata delimiter" help="If tabs use $'\t' " >
                                        <sanitizer>
                                                <valid>
                                                        <add preset="string.printable"/>
                                                        <add value="\"/>
                                                </valid>
                                        </sanitizer>
                                </param>
				<param type="text" name="samp_col" label="Sample Name Column" help="Name or number of column in the metadata that uniquely matches part of the sample name used in the ASV" />
				<param type="text" name="regex" label="ASV name extraction regex." help=" Regex to exctract names form ASV sample names and match them exactly to to metadata samp_col. " optional="true" />
			</when>
			<when value="false">
			</when>
		</conditional>
    </inputs>
	<outputs>
		<data name="output" label="dada2_biom" format="json" />
    </outputs>
    <help><![CDATA[
		
		positional arguments:
			asv                   The ASV count table generated by DADA
			out                   Path to write the BIOM
		
		optional arguments:
			-t TAXA, --taxa TAXA  The taxa table generated by DADA
			-s META, --meta META  Sample metadata, in which rows are samples
			-d DELIM, --delim DELIM
			The delimiter used in sample metadata.
			-c SAMP_COL, --samp_col SAMP_COL
			The column name, which has sample ids. Ids need to
			have a coraspnding entry in the ASV table, which may
			be a substring int the ASV.
			-r REGEX, --regex REGEX
			Regex used to extract sample id names from the ASV ids
			-n STUDY_ID, --study_id STUDY_ID
			Study ID to be used in the Biom
		
    ]]></help>
    <citations>
		<citation type="doi">10.1038/nmeth.3869</citation>
        <citation type="bibtex">
		@misc{githubGeneLab_DADA2_Paired_Pipeline,
		author = {Erikson, Christian},
		year = {2018},
		title = {GeneLab_DADA2},
		publisher = {GitHub},
		journal = {GitHub repository},
		url = {https://github.com/cErikson/DADA2_cli_and_galaxy_wrapper},
		}</citation>
    </citations>
</tool>
