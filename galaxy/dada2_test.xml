<tool id="DADA2.R" name="DADA2 core" version="1.0">
  <stdio>
    <exit_code level="fatal" range="1:"/>
  </stdio>
  <!--<version_command></version_command> -->
  <command><![CDATA[dada2.R
#set repeat_var_1 = \'" "\'.join([ str($var.fwd) for $var in $repeat_1 ])
-f "$repeat_var_1"


#set repeat_var_2 = \'" "\'.join([ str($var.rev) for $var in $repeat_2 ])
-r "$repeat_var_2"

--asv_out $asv_out


#set repeat_var_5 = \'" "\'.join([ str($var.samp_fields) for $var in $repeat_5 ])
-s "$repeat_var_5"


#if $fields_delim and $fields_delim is not None:
--fields_delim $fields_delim
#end if

#if $samp_regex and $samp_regex is not None:
--samp_regex $samp_regex
#end if

#if $nochim and $nochim is not None:
--nochim $nochim
#end if

#if $LEARN_READS_N and $LEARN_READS_N is not None:
--LEARN_READS_N $LEARN_READS_N
#end if

#if $OMEGA_A and $OMEGA_A is not None:
--OMEGA_A $OMEGA_A
#end if

#if $USE_QUALS and $USE_QUALS is not None:
--USE_QUALS $USE_QUALS
#end if

#if $USE_KMERS and $USE_KMERS is not None:
--USE_KMERS $USE_KMERS
#end if

#if $KDIST_CUTOFF and $KDIST_CUTOFF is not None:
--KDIST_CUTOFF $KDIST_CUTOFF
#end if

#if $BAND_SIZE and $BAND_SIZE is not None:
--BAND_SIZE $BAND_SIZE
#end if

#if $SCORE_MATRIX and $SCORE_MATRIX is not None:
--SCORE_MATRIX $SCORE_MATRIX
#end if

#if $GAP_PENALTY and $GAP_PENALTY is not None:
--GAP_PENALTY $GAP_PENALTY
#end if

#if $HOMOPOLYMER_GAP_PENALTY and $HOMOPOLYMER_GAP_PENALTY is not None:
--HOMOPOLYMER_GAP_PENALTY $HOMOPOLYMER_GAP_PENALTY
#end if

#if $MIN_FOLD and $MIN_FOLD is not None:
--MIN_FOLD $MIN_FOLD
#end if

#if $MIN_HAMMING and $MIN_HAMMING is not None:
--MIN_HAMMING $MIN_HAMMING
#end if

#if $MAX_CLUST and $MAX_CLUST is not None:
--MAX_CLUST $MAX_CLUST
#end if

#if $MAX_CONSIST and $MAX_CONSIST is not None:
--MAX_CONSIST $MAX_CONSIST
#end if

#if $VERBOSE and $VERBOSE is not None:
--VERBOSE $VERBOSE
#end if
> $default]]></command>
  <inputs>
    <repeat min="1" name="repeat_1" title="repeat_title">
      <param area="false" argument="--fwd" label="Name/path to fastq or fastq.gz files for single end sequencing or forward reads if paired end sequencing" name="fwd" optional="false" type="text"/>
    </repeat>
    <repeat min="1" name="repeat_2" title="repeat_title">
      <param area="false" argument="--rev" label="Name/path to fastq or fastq.gz files for reverse reads if paired end sequencing" name="rev" optional="true" type="text" value="false"/>
    </repeat>
    <param area="false" argument="--nochim" label="Method to use in removeBimeraDenovo. `pooled`, `consensus`, `per-sample`, `FALSE` to skip. Default consensus" name="nochim" optional="true" type="text" value="true"/>
    <repeat min="1" name="repeat_5" title="repeat_title">
      <param argument="--samp_fields" label="The fields in the file name that should be used for sample names." name="samp_fields" optional="true" type="t" value="false"/>
    </repeat>
    <param area="false" argument="--fields_delim" label="The field delimiter used in the file name" name="fields_delim" optional="true" type="text" value="_"/>
    <param area="false" argument="--samp_regex" label="Regex used to create samplenames. Double escapes \\w" name="samp_regex" optional="true" type="text" value="false"/>
    <param argument="--LEARN_READS_N" label="Default 1e6. The minimum number of reads to use for error rate learning. Samples are read into memory until at least this number of reads has been reached, or all provided samples have been read in." name="LEARN_READS_N" optional="true" type="integer" value="1000000.0"/>
    <param argument="--OMEGA_A" label="This parameter sets the threshold for when DADA2 calls unique sequences significantly overabundant, and therefore creates a new cluster with that sequence as the center. The default value is 1e-40, which is a conservative setting to avoid making false positive inferences, but which comes at the cost of reducing the ability to identify some rare variants." name="OMEGA_A" optional="true" type="float" value="1e-40"/>
    <param area="false" argument="--USE_QUALS" label="If TRUE, the dada(...) error model takes into account the consensus quality score of the dereplicated unique sequences. If FALSE, quality scores are ignored. The default is TRUE, however if applying DADA2 to pyrosequenced data it is recommended to set USE_QUALS to FALSE, as quality scores are not informative about substitution error rates in pyrosequencing." name="USE_QUALS" optional="true" type="text" value="true"/>
    <param area="false" argument="--USE_KMERS" label="If TRUE, a 5-mer distance screen is performed prior to performing each pairwise alignment, and if the 5mer-distance is greater than KDIST_CUTOFF, no alignment is performed. TRUE by default." name="USE_KMERS" optional="true" type="text" value="true"/>
    <param argument="--KDIST_CUTOFF" label="The default value of 0.42 was chosen to screen pairs of sequences that differ by greater 10 percent, and was calibrated on Illumina sequenced 16S amplicon data. The assumption is that sequences that differ by such a large amount cannot be linked by amplicon errors (i.e. if you sequence one, you won`t get a read of other) and so careful (and costly) alignment is unnecessary." name="KDIST_CUTOFF" optional="true" type="float" value="0.42"/>
    <param argument="--BAND_SIZE" label="When set, banded Needleman-Wunsch alignments are performed. Banding restricts the net cumulative number of insertion of one sequence relative to the other. The default value of BAND_SIZE is 16. If DADA is applied to marker genes with high rates of indels, such as the ITS region in fungi, the BAND_SIZE parameter should be increased. Setting BAND_SIZE to a negative number turns off banding (i.e. full Needleman-Wunsch)." name="BAND_SIZE" optional="true" type="integer" value="16"/>
    <param area="false" argument="--SCORE_MATRIX" label="The path to the score matrix for the Needleman-Wunsch alignment. This is a 4x4 matrix as no ambiguous nucleotides are allowed. Default is nuc44: -4 for mismatches, +5 for matches." name="SCORE_MATRIX" optional="true" type="text"/>
    <param argument="--GAP_PENALTY" label="The cost of gaps in the Needleman-Wunsch alignment. Default is -8." name="GAP_PENALTY" optional="true" type="integer" value="-8"/>
    <param area="false" argument="--HOMOPOLYMER_GAP_PENALTY" label="The cost of gaps in homopolymer regions (&gt;=3 repeated bases). Default is NULL, which causes homopolymer gaps to be treated as normal gaps." name="HOMOPOLYMER_GAP_PENALTY" optional="true" type="text"/>
    <param argument="--MIN_FOLD" label="The minimum fold-overabundance for sequences to form new clusters. Default value is 1, which means this criteria is ignored." name="MIN_FOLD" optional="true" type="integer" value="1"/>
    <param argument="--MIN_HAMMING" label="The minimum hamming-separation for sequences to form new clusters. Default value is 1. which means this criteria is ignored." name="MIN_HAMMING" optional="true" type="integer" value="1"/>
    <param argument="--MAX_CLUST" label="The maximum number of clusters. Once this many clusters have been created, the algorithm terminates regardless of whether the statistical model suggests more sample sequences exist. If set to 0 this argument is ignored. Default value is 0." name="MAX_CLUST" optional="true" type="integer" value="0"/>
    <param argument="--MAX_CONSIST" label="The maximum number of steps when selfConsist=TRUE. If convergence is not reached in MAX_CONSIST steps, the algorithm will terminate with a warning message. Default value is 10." name="MAX_CONSIST" optional="true" type="integer" value="10"/>
    <param area="false" argument="--VERBOSE" label="If TRUE progress messages from the algorithm are printed. Warning: There is a lot of output. Default is FALSE." name="VERBOSE" optional="true" type="text" value="true"/>
  </inputs>
  <outputs>
	<data format= "tsv" label="Name/path to ASV table file output" name="asv_out" />
  </outputs>
  <help><![CDATA[TODO: Write help]]></help>
</tool>
